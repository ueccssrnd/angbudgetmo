// Generated by CoffeeScript 1.6.3
var BudgetMo, Visuals;

BudgetMo = (function() {
  function BudgetMo() {}

  BudgetMo.prototype.vars = {
    base_url: "/",
    tpl_path: "public/tpl/",
    user: "anonymous",
    logged: 0
  };

  BudgetMo.prototype.init = function() {
    this.ui.build();
    this.listen();
    return Visuals.prototype.tempLightboxGraph();
  };

  BudgetMo.prototype.listen = function() {
    return $('#lightbox').on('click', '.light-close', function(e) {
      return BudgetMo.prototype.ui.lightbox.hide();
    });
  };

  BudgetMo.prototype.ui = {
    vars: {
      breadcrumbs: [],
      page: {},
      content_tpl: "home"
    },
    build: function() {},
    lightbox: {
      show: function() {
        return $('#lightbox').show();
      },
      hide: function() {
        return $('#lightbox').hide();
      }
    }
  };

  return BudgetMo;

})();

Visuals = (function() {
  function Visuals() {}

  Visuals.prototype.vars = {
    data: {
      gov: [10, 50, 80, 30, 150],
      collated: [60, 70, 80, 90, 100],
      custom: []
    }
  };

  Visuals.prototype.init = function() {
    var color, height, radius, width;
    height = 400;
    width = 400;
    color = d3.scale.category20b();
    return radius = 150;
  };

  Visuals.prototype.tempLightboxGraph = function() {
    var arc, arcs, canvas, color, data, doughnut, group, height, layout, otherValues, radius, sum, sumOtherVal, update, width;
    height = '100%';
    width = '100%';
    sum = function(arr) {
      var i, _i, _len;
      sum = 0;
      for (_i = 0, _len = arr.length; _i < _len; _i++) {
        i = arr[_i];
        sum += i;
      }
      return sum;
    };
    otherValues = [30, 10, 80];
    sumOtherVal = sum(otherValues);
    data = [50, sumOtherVal];
    color = ["#fcc427", "#888"];
    radius = 150;
    canvas = d3.select(".graph-preview .graph").append("svg").style("width", width).style("height", height);
    arc = d3.svg.arc().outerRadius(radius).innerRadius(radius * 0.8);
    layout = d3.layout.pie().sort(null).value(function(d) {
      return d;
    });
    group = canvas.append("g").attr("transform", "translate(200,200)");
    group.append("circle").attr("cx", 0).attr("cy", 0).attr("r", radius * 0.8).attr("fill", "white");
    group.append("image").attr("xlink:href", "assets/img/social-150.png").attr("x", radius / 2 * -1).attr("y", radius / 2 * -1).attr("width", radius).attr("height", radius);
    arcs = group.selectAll(".arc").data(layout(data)).enter().append("g").attr("class", "arc");
    doughnut = arcs.append("path").attr("d", arc).attr("fill", function(d, i) {
      return color[i];
    }).attr("stroke", "#fff").attr("stroke-width", 2);
    $("#slider").slider({
      value: data[0],
      min: 0,
      max: sumOtherVal + data[0],
      step: 1,
      slide: function(e, ui) {
        return update(data[0], ui.value);
      }
    });
    return update = function(old, value) {
      var difference, newData;
      newData = [value, sumOtherVal + old - value];
      difference = Math.floor(Math.round((sumOtherVal - newData[1]) / otherValues.length));
      console.log(difference);
      arcs.data(layout(newData));
      return arcs.select("path").attr("d", arc);
    };
  };

  return Visuals;

})();

$(document).ready(function() {
  var app;
  app = new BudgetMo;
  return app.init();
});
